<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>7 Working with data | Programming for Psychologists</title>
<meta name="author" content="Martin Schmettow and Lena Brandl">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.8/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="libs/d3-3.3.8/d3.min.js"></script><script src="libs/dagre-0.4.0/dagre-d3.min.js"></script><link href="libs/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet">
<script src="libs/mermaid-0.3.0/dist/mermaid.slim.min.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/chromatography-0.1/chromatography.js"></script><script src="libs/DiagrammeR-binding-1.0.6.1/DiagrammeR.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="A course in Python">Programming for Psychologists</a>:
        <small class="text-muted">A course in Python</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Preface</a></li>
<li><a class="" href="intro.html"><span class="header-section-number">1</span> Introduction</a></li>
<li><a class="" href="variables.html"><span class="header-section-number">2</span> Variables, values and types</a></li>
<li><a class="" href="conditionals.html"><span class="header-section-number">3</span> Conditionals</a></li>
<li><a class="" href="lists.html"><span class="header-section-number">4</span> Lists</a></li>
<li><a class="" href="loops.html"><span class="header-section-number">5</span> Loops</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">6</span> Functions</a></li>
<li><a class="active" href="data.html"><span class="header-section-number">7</span> Working with data</a></li>
<li><a class="" href="interaction.html"><span class="header-section-number">8</span> Interaction</a></li>
<li><a class="" href="solutions.html"><span class="header-section-number">9</span> Solutions</a></li>
<li><a class="" href="debugging-and-good-programming-practices.html"><span class="header-section-number">10</span> Debugging and good programming practices</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="data" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Working with data<a class="anchor" aria-label="anchor" href="#data"><i class="fas fa-link"></i></a>
</h1>
<div class="sourceCode" id="cb417"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>warning <span class="op">=</span> <span class="cn">FALSE</span>, message <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></code></pre></div>
<pre><code>## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --</code></pre>
<pre><code>## v ggplot2 3.3.5     v purrr   0.3.4
## v tibble  3.1.2     v dplyr   1.0.6
## v tidyr   1.1.3     v stringr 1.4.0
## v readr   1.4.0     v forcats 0.5.1</code></pre>
<pre><code>## Warning: package 'ggplot2' was built under R version 4.1.1</code></pre>
<pre><code>## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<div id="elements-of-data-processing" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Elements of data processing<a class="anchor" aria-label="anchor" href="#elements-of-data-processing"><i class="fas fa-link"></i></a>
</h2>
<p>In the previous chapter we have dealt with functions as reusable pieces of code. There is another common notion of what a function is: <em>a function processes data</em>. The basic model of data processing is the following:</p>
<div id="htmlwidget-2a8ee13e2112db293086" style="width:672px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-2a8ee13e2112db293086">{"x":{"diagram":"graph LR\nIN(Input Data) --> PROC[Function]\nPROC --> OUT(Output Data)"},"evals":[],"jsHooks":[]}</script><p>So, what is data? As psychologists we are used to think of data as observations from empirical studies that we process by statistical procedures. That precisely matches our above model:</p>
<div id="htmlwidget-aace666ef783673955ad" style="width:672px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-aace666ef783673955ad">{"x":{"diagram":"graph LR\nIN(Observations) --> PROC[t-test]\nPROC --> OUT(p-value)"},"evals":[],"jsHooks":[]}</script><p>In Python, as a general programming language, there exist libraries that implement tables of observations, as well as the t-test (and more modern statistical procedures, luckily). However, we don’t want to bother you with statistics for the moment. Instead, take another look at two function that we have introduced in <a href="functions.html#functions">6</a>:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb422-1"><a href="data.html#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> summation(alist):</span>
<span id="cb422-2"><a href="data.html#cb422-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">sum</span> <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb422-3"><a href="data.html#cb422-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(alist)):</span>
<span id="cb422-4"><a href="data.html#cb422-4" aria-hidden="true" tabindex="-1"></a>        <span class="bu">sum</span> <span class="op">+=</span> alist[i]</span>
<span id="cb422-5"><a href="data.html#cb422-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Sum of the list is:"</span>, <span class="bu">sum</span>)</span>
<span id="cb422-6"><a href="data.html#cb422-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="bu">sum</span></span>
<span id="cb422-7"><a href="data.html#cb422-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-8"><a href="data.html#cb422-8" aria-hidden="true" tabindex="-1"></a>summation([<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>])</span></code></pre></div>
<pre><code>## Sum of the list is: 10.0
## 10.0</code></pre>
<p>The function <code>summation</code> takes a list of values and computes the sum. Again, that satisfies the basic model of data processing:</p>
<div id="htmlwidget-dba0be90ab73592f4d27" style="width:672px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-dba0be90ab73592f4d27">{"x":{"diagram":"graph LR\nIN(List of numbers) --> PROC[Summation]\nPROC --> OUT(sum)"},"evals":[],"jsHooks":[]}</script><p>It is easy to see how input and output are implemented with Python functions:</p>
<ul>
<li>function arguments provide the input</li>
<li>the function body does the processing</li>
<li>the return statement gives the output</li>
</ul>
<p>Consequently, every function that takes arguments and has a return statement can be considered data processing. Furthermore, data processing can take place as chains. Let’s take the variance of a list of numbers as an example. The formula for variance, shown below, reveals that the variance statistic is produces in three steps: first, the residuals are computed, these are squared an finally the mean value is taken.</p>
<div id="htmlwidget-31dd3d3d72388cd4ab5f" style="width:672px;height:480px;" class="DiagrammeR html-widget"></div>
<script type="application/json" data-for="htmlwidget-31dd3d3d72388cd4ab5f">{"x":{"diagram":"graph LR\n IN(List of numbers) --> PROC_1[square residuals]\n PROC_1 --> OUT_1(List of squared residuals)\n OUT_1 --> PROC_2[take the mean]\n PROC_2 --> OUT(Variance)"},"evals":[],"jsHooks":[]}</script><p>Let’s see how this is implemnented in Python. For the squared residuals, we create our own function, but resort to the function <code>mean</code> in the <code>numpy</code> library. Note how the two defined functions operate on a dedicated list for output, rather than modifying the original one. Recall that lists are called by reference, which means the original list would otherwise be altered by the function.</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb424-1"><a href="data.html#cb424-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> mean</span>
<span id="cb424-2"><a href="data.html#cb424-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-3"><a href="data.html#cb424-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> residuals(lon):</span>
<span id="cb424-4"><a href="data.html#cb424-4" aria-hidden="true" tabindex="-1"></a>    avg <span class="op">=</span> mean(lon)</span>
<span id="cb424-5"><a href="data.html#cb424-5" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> []</span>
<span id="cb424-6"><a href="data.html#cb424-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> lon:</span>
<span id="cb424-7"><a href="data.html#cb424-7" aria-hidden="true" tabindex="-1"></a>          output.append((i <span class="op">-</span> avg))</span>
<span id="cb424-8"><a href="data.html#cb424-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output</span>
<span id="cb424-9"><a href="data.html#cb424-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-10"><a href="data.html#cb424-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> square(lon):</span>
<span id="cb424-11"><a href="data.html#cb424-11" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> []</span>
<span id="cb424-12"><a href="data.html#cb424-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> lon:</span>
<span id="cb424-13"><a href="data.html#cb424-13" aria-hidden="true" tabindex="-1"></a>          output.append(i<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb424-14"><a href="data.html#cb424-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output</span>
<span id="cb424-15"><a href="data.html#cb424-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-16"><a href="data.html#cb424-16" aria-hidden="true" tabindex="-1"></a>LON <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">9</span>]</span>
<span id="cb424-17"><a href="data.html#cb424-17" aria-hidden="true" tabindex="-1"></a>RES <span class="op">=</span> residuals(LON)</span>
<span id="cb424-18"><a href="data.html#cb424-18" aria-hidden="true" tabindex="-1"></a>SQR <span class="op">=</span> square(RES)</span>
<span id="cb424-19"><a href="data.html#cb424-19" aria-hidden="true" tabindex="-1"></a>VAR <span class="op">=</span> mean(SQR)</span>
<span id="cb424-20"><a href="data.html#cb424-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-21"><a href="data.html#cb424-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(VAR)</span></code></pre></div>
<pre><code>## 12.5</code></pre>
<p>The above code represents such a data processing in such a way that the intermediate results are stored in dedicated variables (<code>RES</code>, <code>SQR</code>). While this makes the processing chain clear in the code, for longer chains there is the downside of length and cluttering the program with variables that are just used once. A more compact form to write the chain is by <em>nesting function</em>:</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb426-1"><a href="data.html#cb426-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> mean</span>
<span id="cb426-2"><a href="data.html#cb426-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-3"><a href="data.html#cb426-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> residuals(lon):</span>
<span id="cb426-4"><a href="data.html#cb426-4" aria-hidden="true" tabindex="-1"></a>    avg <span class="op">=</span> mean(lon)</span>
<span id="cb426-5"><a href="data.html#cb426-5" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> []</span>
<span id="cb426-6"><a href="data.html#cb426-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> lon:</span>
<span id="cb426-7"><a href="data.html#cb426-7" aria-hidden="true" tabindex="-1"></a>          output.append((i <span class="op">-</span> avg))</span>
<span id="cb426-8"><a href="data.html#cb426-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output</span>
<span id="cb426-9"><a href="data.html#cb426-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-10"><a href="data.html#cb426-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> square(lon):</span>
<span id="cb426-11"><a href="data.html#cb426-11" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> []</span>
<span id="cb426-12"><a href="data.html#cb426-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> lon:</span>
<span id="cb426-13"><a href="data.html#cb426-13" aria-hidden="true" tabindex="-1"></a>          output.append(i<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb426-14"><a href="data.html#cb426-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output</span>
<span id="cb426-15"><a href="data.html#cb426-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-16"><a href="data.html#cb426-16" aria-hidden="true" tabindex="-1"></a>LON <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">9</span>]</span>
<span id="cb426-17"><a href="data.html#cb426-17" aria-hidden="true" tabindex="-1"></a>VAR <span class="op">=</span> mean(square(residuals(LON)))</span>
<span id="cb426-18"><a href="data.html#cb426-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(VAR)</span></code></pre></div>
<pre><code>## 12.5</code></pre>
<p>Nested function are evaluated inside-out. Consequently, when setting up such a chain, one begins with the first processing step and builds the subsequent one “around” it. While this is conveniently compact, it lacks the intuition of the data processing chain. Therefore, it is best in many situations, to encapsulate the whole line as a dedicated function:</p>
<div class="sourceCode" id="cb428"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb428-1"><a href="data.html#cb428-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> numpy <span class="im">import</span> mean</span>
<span id="cb428-2"><a href="data.html#cb428-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-3"><a href="data.html#cb428-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> residuals(lon):</span>
<span id="cb428-4"><a href="data.html#cb428-4" aria-hidden="true" tabindex="-1"></a>    avg <span class="op">=</span> mean(lon)</span>
<span id="cb428-5"><a href="data.html#cb428-5" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> []</span>
<span id="cb428-6"><a href="data.html#cb428-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> lon:</span>
<span id="cb428-7"><a href="data.html#cb428-7" aria-hidden="true" tabindex="-1"></a>          output.append((i <span class="op">-</span> avg))</span>
<span id="cb428-8"><a href="data.html#cb428-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output</span>
<span id="cb428-9"><a href="data.html#cb428-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-10"><a href="data.html#cb428-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> square(lon):</span>
<span id="cb428-11"><a href="data.html#cb428-11" aria-hidden="true" tabindex="-1"></a>    output <span class="op">=</span> []</span>
<span id="cb428-12"><a href="data.html#cb428-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> lon:</span>
<span id="cb428-13"><a href="data.html#cb428-13" aria-hidden="true" tabindex="-1"></a>          output.append(i<span class="op">**</span><span class="dv">2</span>)</span>
<span id="cb428-14"><a href="data.html#cb428-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> output</span>
<span id="cb428-15"><a href="data.html#cb428-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb428-16"><a href="data.html#cb428-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> variance(lon):</span>
<span id="cb428-17"><a href="data.html#cb428-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mean(square(residuals(lon)))</span>
<span id="cb428-18"><a href="data.html#cb428-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb428-19"><a href="data.html#cb428-19" aria-hidden="true" tabindex="-1"></a>LON <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">8</span>, <span class="dv">2</span>, <span class="dv">9</span>]</span>
<span id="cb428-20"><a href="data.html#cb428-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(variance(LON))</span></code></pre></div>
<pre><code>## 12.5</code></pre>
<p>This simple example highlights another important aspect about the data processing model: models can be nested. The function variance is itself a data processing chain, but it can take a role in a more global data processing chain. For example, when you prepare a summary statistics table for your report, you use the variance function as part of it. You do care about its required input and know what it will produce, but you don’t worry about the above processing chain, anymore. That is called a <em>black box</em>.</p>
</div>
<div id="data-tables" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Data tables<a class="anchor" aria-label="anchor" href="#data-tables"><i class="fas fa-link"></i></a>
</h2>
<p>The purpose of psychological experiments is to collect data from participants under various conditions. Imagine you wanted to analyze the data from a single participant in the Stroop task. Perhaps, you wanted to analyze it as a factorial linear model (or ANOVA, if you like). Your data analysis program most likely expects the data in the following form:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">Condition</th>
<th align="left">Correctness</th>
<th align="right">RT</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">congruent</td>
<td align="left">TRUE</td>
<td align="right">800.9212</td>
</tr>
<tr class="even">
<td align="left">congruent</td>
<td align="left">FALSE</td>
<td align="right">696.8643</td>
</tr>
<tr class="odd">
<td align="left">congruent</td>
<td align="left">TRUE</td>
<td align="right">765.2435</td>
</tr>
<tr class="even">
<td align="left">congruent</td>
<td align="left">FALSE</td>
<td align="right">814.3323</td>
</tr>
<tr class="odd">
<td align="left">incongruent</td>
<td align="left">TRUE</td>
<td align="right">630.5570</td>
</tr>
<tr class="even">
<td align="left">incongruent</td>
<td align="left">FALSE</td>
<td align="right">686.0606</td>
</tr>
<tr class="odd">
<td align="left">incongruent</td>
<td align="left">TRUE</td>
<td align="right">693.3339</td>
</tr>
<tr class="even">
<td align="left">incongruent</td>
<td align="left">TRUE</td>
<td align="right">731.7975</td>
</tr>
</tbody>
</table></div>
<p>How would you create such a table in Python? The most simple form is to regard every column as a separate list and you would initialize the data gathering by creating three empty lists. In the main part of the program you can then populate the three lists separately, for example:</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb430-1"><a href="data.html#cb430-1" aria-hidden="true" tabindex="-1"></a>Condition <span class="op">=</span> []</span>
<span id="cb430-2"><a href="data.html#cb430-2" aria-hidden="true" tabindex="-1"></a>Correctness <span class="op">=</span> []</span>
<span id="cb430-3"><a href="data.html#cb430-3" aria-hidden="true" tabindex="-1"></a>RT <span class="op">=</span> []</span>
<span id="cb430-4"><a href="data.html#cb430-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb430-5"><a href="data.html#cb430-5" aria-hidden="true" tabindex="-1"></a>Condition.append(this_condition)</span>
<span id="cb430-6"><a href="data.html#cb430-6" aria-hidden="true" tabindex="-1"></a>Correctness.append(this_correctness)</span>
<span id="cb430-7"><a href="data.html#cb430-7" aria-hidden="true" tabindex="-1"></a>RT.append(this_reaction_time)</span></code></pre></div>
</div>
<div id="down-the-sink-writing-data-files" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Down the sink: Writing data files<a class="anchor" aria-label="anchor" href="#down-the-sink-writing-data-files"><i class="fas fa-link"></i></a>
</h2>
<p>In the case of psychological experiments, the main part of the data processing is most likely done in other programs, such as R, SPSS or Excel. These programs can make little use of data that is stored in Python variables. Rather, data is read in from files. While all programs have their own data format for tables (and specialized functions exist for some), the Lingua Franca of file based data exchange is the <em>comma-separated-values (CSV)</em> form. This is almost as easy as it sounds:</p>
<ul>
<li>every row of data is represented as a row of text</li>
<li>all values in a row are separated by commata</li>
</ul>
<p>The example data set above would look like the following in CSV:</p>
<div class="sourceCode" id="cb431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html">write.csv</a></span><span class="op">(</span><span class="va">D_Stroop</span>, file <span class="op">=</span> <span class="st">""</span>, eol <span class="op">=</span> <span class="st">"\n\n"</span><span class="op">)</span></code></pre></div>
<pre><code>## "","Condition","Correctness","RT"
## 
## "1","congruent",TRUE,800.921185693852
## 
## "2","congruent",FALSE,696.864295047379
## 
## "3","congruent",TRUE,765.243482711174
## 
## "4","congruent",FALSE,814.332269635055
## 
## "5","incongruent",TRUE,630.556964944383
## 
## "6","incongruent",FALSE,686.060561659131
## 
## "7","incongruent",TRUE,693.333933180317
## 
## "8","incongruent",TRUE,731.797519903504</code></pre>
<p>In order to write such a file, we could use a loop function, together with string concatenation. Fortunately, the <code>csv</code> library that comes with Python implements CSV export right-away. However, it is not as simple as issueing just one command.
Dealing with files is an issue on its own. Unlike variables, which are linked to a running program, files are just dumb sinks on the hard disk on your computer. What must not happen is that, for example, two programs modify the file simultaneously, as this would create a mess. Therefore, the operating system takes special care of files and ensures that only one programn can write it at a time (simultaneous reading is less of a problem). To signal the operating system that a file is being written, some decoration is necessary. More specifically, the programmer must first create a <em>fileg handler</em> on the file, which is what the command <code>open</code> does.</p>
<p>Then the csv library commands operate on the writing handler. This happens by means of a <em>writing handler</em>, which is created by the function <code>csv.writer</code>. Then, the function <code>writerow</code> adds the rows of a table, one by one. That is slightly inconvenient, because our data table is arranged by columns (the three lists) in the first place. For that reason, the <code>for</code> loops first gathers every row of the table as a list <code>this_row</code>.
And finally, the <code>close</code> command signals the operating system that the file is no longer in use.</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb433-1"><a href="data.html#cb433-1" aria-hidden="true" tabindex="-1"></a>Condition <span class="op">=</span> [<span class="st">"incongruent"</span>, <span class="st">"incongruent"</span>, <span class="st">"congruent"</span>]</span>
<span id="cb433-2"><a href="data.html#cb433-2" aria-hidden="true" tabindex="-1"></a>Correctness <span class="op">=</span> [<span class="va">False</span>, <span class="va">False</span>, <span class="va">True</span>]</span>
<span id="cb433-3"><a href="data.html#cb433-3" aria-hidden="true" tabindex="-1"></a>RT <span class="op">=</span> [<span class="dv">800</span>, <span class="dv">696</span>, <span class="dv">765</span>]</span>
<span id="cb433-4"><a href="data.html#cb433-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb433-5"><a href="data.html#cb433-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb433-6"><a href="data.html#cb433-6" aria-hidden="true" tabindex="-1"></a>myfile <span class="op">=</span>  <span class="bu">open</span>(<span class="st">"Stroop.csv"</span>, mode <span class="op">=</span> <span class="st">"w"</span>)</span>
<span id="cb433-7"><a href="data.html#cb433-7" aria-hidden="true" tabindex="-1"></a>writer <span class="op">=</span> csv.writer(myfile)</span>
<span id="cb433-8"><a href="data.html#cb433-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">len</span>(Condition)):</span>
<span id="cb433-9"><a href="data.html#cb433-9" aria-hidden="true" tabindex="-1"></a>    thisrow <span class="op">=</span> [Condition[i], Correctness[i], RT[i]]</span>
<span id="cb433-10"><a href="data.html#cb433-10" aria-hidden="true" tabindex="-1"></a>    writer.writerow(thisrow)</span></code></pre></div>
<pre><code>## 23
## 23
## 20</code></pre>
<div class="sourceCode" id="cb435"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb435-1"><a href="data.html#cb435-1" aria-hidden="true" tabindex="-1"></a>myfile.close()</span></code></pre></div>
<p>As a general rule, it is good to keep the period between open and close short. Especially, one should not open the file at the start of the program and close it when it quits. Programs in development (and written by apprentices) tend to crash and that means data loss and potential file corruption. The safest way probably is to open the file after an observation has been gathered, append the observation and close it immediatly.</p>
<p>So how do we append rows to an existing file? A closer look at the <code>open</code> function reveals that it takes a second parameter, the <code>mode</code>, which is of type string. Three major mode exists (plus a bunch of fine-tuning options):</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="left">mode</th>
<th align="left"></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">r</td>
<td align="left">reading</td>
</tr>
<tr class="even">
<td align="left">w</td>
<td align="left">writing</td>
</tr>
<tr class="odd">
<td align="left">a</td>
<td align="left">appending</td>
</tr>
</tbody>
</table></div>
<p>Hence, the code for writing an observation one-by-one could be:</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb436-1"><a href="data.html#cb436-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb436-2"><a href="data.html#cb436-2" aria-hidden="true" tabindex="-1"></a>myfile <span class="op">=</span>  <span class="bu">open</span>(<span class="st">"Stroop.csv"</span>, mode <span class="op">=</span> <span class="st">"a"</span>)</span>
<span id="cb436-3"><a href="data.html#cb436-3" aria-hidden="true" tabindex="-1"></a>writer <span class="op">=</span> csv.writer(myfile)</span>
<span id="cb436-4"><a href="data.html#cb436-4" aria-hidden="true" tabindex="-1"></a>writer.writerow([thisCondition, thisCorrectness, thisRT])</span>
<span id="cb436-5"><a href="data.html#cb436-5" aria-hidden="true" tabindex="-1"></a>myfile.close()</span></code></pre></div>
</div>
<div id="may-the-source-reading-data-files" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> May the source …: reading data files<a class="anchor" aria-label="anchor" href="#may-the-source-reading-data-files"><i class="fas fa-link"></i></a>
</h2>
<p>A processing chain starts with a data source, no matter what. The source can be one of three kinds:</p>
<ol style="list-style-type: decimal">
<li>a function call, for example one that produces random numbers</li>
<li>user input, such as the response time, which is derived from a button press</li>
<li>data files</li>
</ol>
<p>The first two options we have already covered in this course. In the following we will see how to read in data from files. Files are typically produced by other programs. For tables that could be Excel (or a programming editor, if you like). As we have seen, CVS is a good choice.</p>
<p>In the Stroop program, we currently use only one external source of data, the user responses. All other data, like the words andf colors are just coded as list, tupels and dictionaries. Reading data from files seems an unncecessary exercise at first, but in fact can make the program more flexibel when used by non-programmers. A possible scenario for the Stroop task is that different experimenters use it, but with their own sets of colors. Here is how one could do it. First, we prepare a table that assigns color words to their respective RGB codes and save it as a CSV file. Any spreadsheet program is suited for the job.</p>
<p>Lets assume the above table has been created in Excel and saved as <code>Colors.csv</code>. The following Python codes opens the csv file and creates a reader (analog to the writer above). Then four lists are created that will capture the table columns. The for loop walks the reader through the CSV file line-by-line. As the first line of the file (with index 0) typically contains the column names, it is omitted. The result is four lists of the same length which makes a table. By using two integer ramdom numbers, we can select a color word, and the ink color and which we can produce the stimuli.</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb437-1"><a href="data.html#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb437-2"><a href="data.html#cb437-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb437-3"><a href="data.html#cb437-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-4"><a href="data.html#cb437-4" aria-hidden="true" tabindex="-1"></a>csv_file   <span class="op">=</span> <span class="bu">open</span>(<span class="st">"Colors.csv"</span>)</span>
<span id="cb437-5"><a href="data.html#cb437-5" aria-hidden="true" tabindex="-1"></a>csv_reader <span class="op">=</span> csv.reader(csv_file)</span>
<span id="cb437-6"><a href="data.html#cb437-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-7"><a href="data.html#cb437-7" aria-hidden="true" tabindex="-1"></a>Color <span class="op">=</span> []</span>
<span id="cb437-8"><a href="data.html#cb437-8" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> []</span>
<span id="cb437-9"><a href="data.html#cb437-9" aria-hidden="true" tabindex="-1"></a>G <span class="op">=</span> []</span>
<span id="cb437-10"><a href="data.html#cb437-10" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> []</span>
<span id="cb437-11"><a href="data.html#cb437-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-12"><a href="data.html#cb437-12" aria-hidden="true" tabindex="-1"></a>row_number <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb437-13"><a href="data.html#cb437-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-14"><a href="data.html#cb437-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> row <span class="kw">in</span> csv_reader:</span>
<span id="cb437-15"><a href="data.html#cb437-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> row_number <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb437-16"><a href="data.html#cb437-16" aria-hidden="true" tabindex="-1"></a>    Color.append(row[<span class="dv">0</span>])</span>
<span id="cb437-17"><a href="data.html#cb437-17" aria-hidden="true" tabindex="-1"></a>    R.append(row[<span class="dv">1</span>])</span>
<span id="cb437-18"><a href="data.html#cb437-18" aria-hidden="true" tabindex="-1"></a>    G.append(row[<span class="dv">2</span>])</span>
<span id="cb437-19"><a href="data.html#cb437-19" aria-hidden="true" tabindex="-1"></a>    B.append(row[<span class="dv">3</span>])</span>
<span id="cb437-20"><a href="data.html#cb437-20" aria-hidden="true" tabindex="-1"></a>  row_number <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb437-21"><a href="data.html#cb437-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb437-22"><a href="data.html#cb437-22" aria-hidden="true" tabindex="-1"></a>csv_file.close()</span>
<span id="cb437-23"><a href="data.html#cb437-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-24"><a href="data.html#cb437-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-25"><a href="data.html#cb437-25" aria-hidden="true" tabindex="-1"></a>this_word  <span class="op">=</span> random.randint(<span class="dv">0</span>,<span class="dv">2</span>)</span>
<span id="cb437-26"><a href="data.html#cb437-26" aria-hidden="true" tabindex="-1"></a>this_color <span class="op">=</span> random.randint(<span class="dv">0</span>,<span class="dv">2</span>)</span>
<span id="cb437-27"><a href="data.html#cb437-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb437-28"><a href="data.html#cb437-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Presenting"</span>, </span>
<span id="cb437-29"><a href="data.html#cb437-29" aria-hidden="true" tabindex="-1"></a>Color[this_word], <span class="st">"in color"</span>, Color[this_color], <span class="st">"("</span>, </span>
<span id="cb437-30"><a href="data.html#cb437-30" aria-hidden="true" tabindex="-1"></a>R[this_color],</span>
<span id="cb437-31"><a href="data.html#cb437-31" aria-hidden="true" tabindex="-1"></a>G[this_color],</span>
<span id="cb437-32"><a href="data.html#cb437-32" aria-hidden="true" tabindex="-1"></a>B[this_color], <span class="st">")"</span>)</span></code></pre></div>
<pre><code>## Presenting orange in color green ( 0 150 150 )</code></pre>
<!-- To give a more compelling example for when it is useful to load stimuli at runtime: A modified version of the experiment is the primed Stroop task that by which one can assess the strength of certain semantic associations. It differs from the original in that it -->
<!-- + shows a priming picture upfront (e.g. a wolf) -->
<!-- + uses no color words, but target words that the participant may associate with the picture (e.g., the word "grandmother") -->
<!-- The assessment of association strength typically takes place within a certain domain, e.g. attitude towards computers or fairy tales. Researchers may therefore want to use same program, but feed it with different sets of images and target words. What one could do, is: -->
<!-- + import one table with the target words -->
<!-- + import one table with the filenames of all images -->
<!-- + read the images in one-by-one -->
</div>
<div id="exercises-6" class="section level2" number="7.5">
<h2>
<span class="header-section-number">7.5</span> Exercises<a class="anchor" aria-label="anchor" href="#exercises-6"><i class="fas fa-link"></i></a>
</h2>
<div id="exercise-1" class="section level3" number="7.5.1">
<h3>
<span class="header-section-number">7.5.1</span> Exercise 1<a class="anchor" aria-label="anchor" href="#exercise-1"><i class="fas fa-link"></i></a>
</h3>
<p>Write a simple image presentation program, that takes a table of the following form as input and changes to the following picture on key press.</p>
<div class="sourceCode" id="cb439"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>File <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Image01.jpg"</span>, <span class="st">"Image02.jpg"</span>, <span class="st">"Image03.jpg"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 1
##   File       
##   &lt;chr&gt;      
## 1 Image01.jpg
## 2 Image02.jpg
## 3 Image03.jpg</code></pre>
<p>When that works, make the program automatic. Add a column to the table that gives the presentation time for an image in seconds.</p>
</div>
<div id="exercise-2" class="section level3" number="7.5.2">
<h3>
<span class="header-section-number">7.5.2</span> Exercise 2<a class="anchor" aria-label="anchor" href="#exercise-2"><i class="fas fa-link"></i></a>
</h3>
<p>With the Python library <code>openpyxl</code> you can read and write Excel files, directly. Work through (this tutorial)[<a href="https://automatetheboringstuff.com/chapter12/" class="uri">https://automatetheboringstuff.com/chapter12/</a>]. Now modify your presentation program to use an Excel files as input.</p>
</div>
</div>
<div id="think-further-6" class="section level2" number="7.6">
<h2>
<span class="header-section-number">7.6</span> Think further<a class="anchor" aria-label="anchor" href="#think-further-6"><i class="fas fa-link"></i></a>
</h2>
<p>If you are working with data tables a lot, it may be worth to take a look at the Pandas library. The primary contribution of Pandas is an object class <em>DataFrame</em>, which captures a whole table at once and provides a plethora of useful methods for filtering and manipulation of data. And there are also commands to read and write csv files into a data frame.</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb441-1"><a href="data.html#cb441-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas</span>
<span id="cb441-2"><a href="data.html#cb441-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb441-3"><a href="data.html#cb441-3" aria-hidden="true" tabindex="-1"></a>Colors <span class="op">=</span> pandas.read_csv(<span class="st">"colors.csv"</span>)</span>
<span id="cb441-4"><a href="data.html#cb441-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb441-5"><a href="data.html#cb441-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(Colors)</span></code></pre></div>
<pre><code>##     Color    R    G    B
## 0  violet  180    0  180
## 1   green    0  150  150
## 2  orange  255  150    0</code></pre>
</div>
<div id="references-1" class="section level2" number="7.7">
<h2>
<span class="header-section-number">7.7</span> References<a class="anchor" aria-label="anchor" href="#references-1"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="functions.html"><span class="header-section-number">6</span> Functions</a></div>
<div class="next"><a href="interaction.html"><span class="header-section-number">8</span> Interaction</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#data"><span class="header-section-number">7</span> Working with data</a></li>
<li><a class="nav-link" href="#elements-of-data-processing"><span class="header-section-number">7.1</span> Elements of data processing</a></li>
<li><a class="nav-link" href="#data-tables"><span class="header-section-number">7.2</span> Data tables</a></li>
<li><a class="nav-link" href="#down-the-sink-writing-data-files"><span class="header-section-number">7.3</span> Down the sink: Writing data files</a></li>
<li><a class="nav-link" href="#may-the-source-reading-data-files"><span class="header-section-number">7.4</span> May the source …: reading data files</a></li>
<li>
<a class="nav-link" href="#exercises-6"><span class="header-section-number">7.5</span> Exercises</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#exercise-1"><span class="header-section-number">7.5.1</span> Exercise 1</a></li>
<li><a class="nav-link" href="#exercise-2"><span class="header-section-number">7.5.2</span> Exercise 2</a></li>
</ul>
</li>
<li><a class="nav-link" href="#think-further-6"><span class="header-section-number">7.6</span> Think further</a></li>
<li><a class="nav-link" href="#references-1"><span class="header-section-number">7.7</span> References</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Programming for Psychologists</strong>: A course in Python" was written by Martin Schmettow and Lena Brandl. It was last built on 2021-11-01.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer>
</body>
</html>
